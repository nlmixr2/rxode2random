<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Note this Inverse wishart rescaled to match the original scale of
the covariance matrix."><title>Sample a covariance Matrix from the Posterior Inverse Wishart
distribution. — cvPost • rxode2random</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample a covariance Matrix from the Posterior Inverse Wishart
distribution. — cvPost"><meta property="og:description" content="Note this Inverse wishart rescaled to match the original scale of
the covariance matrix."><meta property="og:image" content="https://nlmixr2.github.io/rxode2random/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rxode2random</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2random/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Sample a covariance Matrix from the Posterior Inverse Wishart
distribution.</h1>
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/rxode2random/blob/HEAD/R/rxrandom.R" class="external-link"><code>R/rxrandom.R</code></a></small>
      <div class="d-none name"><code>cvPost.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Note this Inverse wishart rescaled to match the original scale of
the covariance matrix.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cvPost</span><span class="op">(</span></span>
<span>  <span class="va">nu</span>,</span>
<span>  <span class="va">omega</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  omegaIsChol <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  returnChol <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"invWishart"</span>, <span class="st">"lkj"</span>, <span class="st">"separation"</span><span class="op">)</span>,</span>
<span>  diagXformType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log"</span>, <span class="st">"identity"</span>, <span class="st">"variance"</span>, <span class="st">"nlmixrSqrt"</span>, <span class="st">"nlmixrLog"</span>,</span>
<span>    <span class="st">"nlmixrIdentity"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>nu</dt>
<dd><p>Degrees of Freedom (Number of Observations) for
covariance matrix simulation.</p></dd>


<dt>omega</dt>
<dd><p>Either the estimate of covariance matrix or the
estimated standard deviations in matrix form each row forming
the standard deviation simulated values</p></dd>


<dt>n</dt>
<dd><p>Number of Matrices to sample.  By default this is 1.
This is only useful when <code>omega</code> is a matrix.  Otherwise
it is determined by the number of rows in the input
<code>omega</code> matrix of standard deviations</p></dd>


<dt>omegaIsChol</dt>
<dd><p>is an indicator of if the omega matrix is in
the Cholesky decomposition. This is only used when codetype="invWishart"</p></dd>


<dt>returnChol</dt>
<dd><p>Return the Cholesky decomposition of the
covariance matrix sample. This is only used when codetype="invWishart"</p></dd>


<dt>type</dt>
<dd><p>The type of covariance posterior that is being
simulated.  This can be:</p><ul><li><p><code>invWishart</code> The posterior is an inverse wishart; This allows
for correlations between parameters to be modeled.  All the
uncertainty in the parameter is captured in the degrees of freedom
parameter.</p></li>
<li><p><code>lkj</code> The posterior separates the standard deviation
estimates (modeled outside and provided in the <code>omega</code>
argument) and the correlation estimates. The correlation estimate
is simulated with the <code><a href="rLKJ1.html">rLKJ1()</a></code>.  This simulation uses
the relationship <code>eta=(nu-1)/2</code>.  This is relationship based
on the proof of the relationship between the restricted
LKJ-distribution and inverse wishart distribution (XXXXXX).  Once
the correlation posterior is calculated, the estimated standard
deviations are then combined with the simulated correlation matrix
to create the covariance matrix.</p></li>
<li><p><code>separation</code> Like the <code>lkj</code> option, this separates out
the estimation of the correlation and standard deviation.  Instead
of using the <code>LKJ</code> distribution to simulate the correlation,
it simulates the inverse wishart of the identity matrix and
converts the result to a correlation matrix.  This correlation
matrix is then used with the standard deviation to calculate the
simulated covariance matrix.</p></li>
</ul></dd>


<dt>diagXformType</dt>
<dd><p>Diagonal transformation type.  These could be:</p><ul><li><p><code>log</code> The standard deviations are log transformed, so the
actual standard deviations are exp(omega)</p></li>
<li><p><code>identity</code> The standard deviations are not transformed. The
standard deviations are not transformed;  They should be positive.</p></li>
<li><p><code>variance</code> The variances are specified in the <code>omega</code>
matrix; They are transformed into standard deviations.</p></li>
<li><p><code>nlmixrSqrt</code> These standard deviations come from an nlmixr
omega matrix where diag(chol(inv(omega))) = x^2</p></li>
<li><p><code>nlmixrLog</code> These standard deviations come from a nlmixr
omega matrix omega matrix where diag(chol(solve(omega))) = exp(x)</p></li>
<li><p><code>nlmixrIdentity</code> These standard deviations come from a nlmixr
omega matrix omega matrix where diag(chol(solve(omega))) = x</p></li>
</ul><p>The nlmixr transformations only make sense when there is no
off-diagonal correlations modeled.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a matrix (n=1) or a list of matrices  (n &gt; 1)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If your covariance matrix is a 1x1 matrix, this uses an scaled
inverse chi-squared which is equivalent to the Inverse Wishart
distribution in the uni-directional case.</p>
<p>In general, the separation strategy is preferred for diagonal
matrices.  If the dimension of the matrix is below 10, <code>lkj</code>
is numerically faster than <code>separation</code> method.  However, the
<code>lkj</code> method has densities too close to zero (XXXX) when the
dimension is above 10.  In that case, though computationally more
expensive <code>separation</code> method performs better.</p>
<p>For matrices with modeled covariances, the easiest method to use
is the inverse Wishart which allows the simulation of correlation
matrices (XXXX).  This method is more well suited for well behaved
matrices, that is the variance components are not too low or too
high.  When modeling nonlinear mixed effects modeling matrices
with too high or low variances are considered sub-optimal in
describing a system.  With these rules in mind, it is reasonable
to use the inverse Wishart.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Alvarez I, Niemi J and Simpson M. (2014) <em>Bayesian Inference for a
Covariance Matrix</em>. Conference on Applied Statistics in Agriculture.
<a href="https://newprairiepress.org/cgi/viewcontent.cgi?article=1004&amp;context=agstatconference" class="external-link">https://newprairiepress.org/cgi/viewcontent.cgi?article=1004&amp;context=agstatconference</a></p>
<p>Wang1 Z, Wu Y, and Chu H. (2018) <em>On Equivalence of the LKJ
distribution and the restricted Wishart distribution</em>. arXiv:1809.04746</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Matthew L.Fidler &amp; Wenping Wang</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sample a single covariance.</span></span></span>
<span class="r-in"><span><span class="va">draw1</span> <span class="op">&lt;-</span> <span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, matrix(c(1, 0.3, 0.3, 1), 2, 2)):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sample 3 covariances</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">draw3</span> <span class="op">&lt;-</span> <span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, matrix(c(1, 0.3, 0.3, 1), 2, 2), n = 3):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sample 3 covariances, but return the cholesky decomposition</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">draw3c</span> <span class="op">&lt;-</span> <span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">3</span>, returnChol <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, matrix(c(1, 0.3, 0.3, 1), 2, 2), n = 3, returnChol = TRUE):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sample 3 covariances with lognormal standard deviations via LKJ</span></span></span>
<span class="r-in"><span><span class="co">## correlation sample</span></span></span>
<span class="r-in"><span><span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"lkj"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, sapply(1:3, function(...) {    rnorm(10)}), type = "lkj"):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## or return cholesky decomposition</span></span></span>
<span class="r-in"><span><span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>type <span class="op">=</span> <span class="st">"lkj"</span>,</span></span>
<span class="r-in"><span>returnChol <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, sapply(1:3, function(...) {    rnorm(10)}), type = "lkj", returnChol = TRUE):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sample 3 covariances with lognormal standard deviations via separation</span></span></span>
<span class="r-in"><span><span class="co">## strategy using inverse Wishart correlation sample</span></span></span>
<span class="r-in"><span><span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"separation"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, sapply(1:3, function(...) {    rnorm(10)}), type = "separation"):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## or returning the cholesky decomposition</span></span></span>
<span class="r-in"><span><span class="fu">cvPost</span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>type <span class="op">=</span> <span class="st">"separation"</span>,</span></span>
<span class="r-in"><span>returnChol <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cvPost(3, sapply(1:3, function(...) {    rnorm(10)}), type = "separation", returnChol = TRUE):</span> function '_lotriLstToMat' not provided by package 'lotri'</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matthew L. Fidler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

